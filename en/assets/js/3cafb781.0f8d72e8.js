"use strict";(self.webpackChunkutm_doc=self.webpackChunkutm_doc||[]).push([[7568],{2815:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"FAQ/FAQ","title":"SITL ","description":"Using ProSim version matching","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/12_FAQ/FAQ.md","sourceDirName":"12_FAQ","slug":"/FAQ/FAQ","permalink":"/en/FAQ/FAQ","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"SITL ","source":"https://wiki.utmsys.org/FAQ/%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB"},"sidebar":"tutorialSidebar","previous":{"title":"12. \u5e38\u89c1\u95ee\u9898","permalink":"/en/12_FAQ"},"next":{"title":"13. \u53d1\u5e03\u65e5\u5fd7","permalink":"/en/13_Release"}}');var i=s(4848),r=s(8453);const l={title:"SITL ",source:"https://wiki.utmsys.org/FAQ/%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB"},o=void 0,a={},c=[{value:"Using ProSim version matching",id:"using-prosim-version-matching",level:2},{value:"SITL",id:"sitl",level:2},{value:"1. Emulator timestamp alignment",id:"1-emulator-timestamp-alignment",level:3},{value:"Problem",id:"problem",level:4},{value:"Solution",id:"solution",level:4},{value:"Reference",id:"reference",level:4}];function d(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",img:"img",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"using-prosim-version-matching",children:"Using ProSim version matching"}),"\n",(0,i.jsx)(n.p,{children:"When using ProSim, the running prompts are as follows:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-markdown",children:"Waiting for connect PX4\n"})}),"\n",(0,i.jsx)(n.p,{children:"Check whether the current PX4 version matches the ProSim version. You can check it by entering the following command in the MAVlink Shell of QGS:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-markdown",children:"ver all\n"})}),"\n",(0,i.jsx)(n.h2,{id:"sitl",children:"SITL"}),"\n",(0,i.jsx)(n.h3,{id:"1-emulator-timestamp-alignment",children:"1. Emulator timestamp alignment"}),"\n",(0,i.jsx)(n.h4,{id:"problem",children:"Problem"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-markdown",children:"pxh> INFO  [lockstep_scheduler] setting initial absolute time to 2900000 us\nERROR [vehicle_imu] 0 - gyro 1310988 timestamp error timestamp_sample: 0, previous timestamp_sample: 0\nERROR [vehicle_imu] 0 - accel 1310988 timestamp error timestamp_sample: 0, previous timestamp_sample: 0\n"})}),"\n",(0,i.jsx)(n.h4,{id:"solution",children:"Solution"}),"\n",(0,i.jsxs)(n.p,{children:["Reference link: ",(0,i.jsx)(n.a,{href:"https://blog.csdn.net/2401_83038233/article/details/149101727",children:"https://blog.csdn.net/2401_83038233/article/details/149101727"})]}),"\n",(0,i.jsxs)(n.p,{children:["Enter the ",(0,i.jsx)(n.a,{href:"https://so.csdn.net/so/search?q=PX4&spm=1001.2101.3001.7020",children:"PX4"})," -Autopilot directory (PX4 source code directory) and ",(0,i.jsx)(n.strong,{children:"enter the following command to start the simulation"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cobol",children:"make px4_sitl gz_x500\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"PX4 and Gazebo are started, QGC is connected to PX4 normally, and PX4 in Gazebo can be controlled through QGC's virtual joystick:"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.img,{src:"https://i-blog.csdnimg.cn/direct/421261bbeba047bc82ef37239411a73e.png",alt:""})})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"The following error message appears shortly after the simulation:"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"In fact, the core error should be:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cobol",children:"ERROR [vehicle_imu] 0 - gyro 1310988 timestamp error timestamp_sample: 1110864000, previous timestamp_samplERROR [vehicle_imu] 0 - accel 1310988 timestamp error timestamp_sample: 1110864000, previous timestamp_samp\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"We can find out from the error that this is an error related to time synchronization, or in other words, it is related to timestamp alignment."})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"In the latest version of PX4 source code, there is a noteworthy section in the build file CMakeLists:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cobol",children:'if(${PX4_PLATFORM} STREQUAL "posix")\n\n    if(ENABLE_LOCKSTEP_SCHEDULER)\n\n        add_definitions(-DENABLE_LOCKSTEP_SCHEDULER)\n\n        message(STATUS "PX4 lockstep: enabled")\n\n    else()\n\n        message(STATUS "PX4 lockstep: disabled")\n\n    endif()\n\nendif()\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"This is the fundamental idea for solving our problem"}),". The code is explained as follows:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cobol",children:"\u9501\u6b65\u8c03\u5ea6\u5668\uff08Lockstep Scheduler\uff09\u662f PX4 \u5728\u4eff\u771f\u73af\u5883\uff08\u5982 SITL\uff09\u4e0b\u7684\u4e00\u79cd\u7279\u6b8a\u8c03\u5ea6\u65b9\u5f0f\uff0c\u53ef\u4ee5\u8ba9 PX4 \u7684\u8fd0\u884c\u901f\u5ea6\u548c\u4eff\u771f\u5668\uff08\u5982 Gazebo\uff09\u7684\u4eff\u771f\u6b65\u8fdb\u4e25\u683c\u540c\u6b65\uff0c\u4fdd\u8bc1\u4eff\u771f\u548c\u98de\u63a7\u4e4b\u95f4\u4e0d\u4f1a\u6709\u65f6\u95f4\u6f02\u79fb\u3002\u8fd9\u5bf9\u4e8e\u81ea\u52a8\u5316\u6d4b\u8bd5\u548c\u9ad8\u7cbe\u5ea6\u4eff\u771f\u975e\u5e38\u91cd\u8981\u3002\n\n \n\n \n\n\u53ef\u4ee5\u901a\u8fc7 \\\\`-DENABLE_LOCKSTEP_SCHEDULER=ON\\\\` \u63a7\u5236\u542f\u7528\u9501\u6b65\u8c03\u5ea6\u5668\u3002\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"So in fact this is caused by the simulation time not being strictly synchronized"}),", and the startup instruction becomes as follows:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cobol",children:'make px4_sitl gz_x500 EXTRA_CMAKE_ARGS="-DENABLE_LOCKSTEP_SCHEDULER=ON"\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"You can also write variables into environment variables"}),". If you are looking for a long-term solution, I will not elaborate on this here."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cobol",children:"\u6d4b\u8bd5\u73af\u5883\uff1aUbuntu22.04\uff0cWSL2\uff0cROS2 Humble\uff0cPX4 V1.16.0\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"In fact, we will also find that the error is eliminated at the same time:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cobol",children:"Error: Interrupted system call\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"The effect is as follows:"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.img,{src:"https://i-blog.csdnimg.cn/direct/421261bbeba047bc82ef37239411a73e.png",alt:""})})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Welcome to exchange and supplement!"})," ",(0,i.jsxs)(n.a,{href:"https://mbot1.blog.csdn.net/article/details/125715844",children:[(0,i.jsx)(n.em,{children:"PX4"})," from giving up to mastering (Part 25): EKF2"]})]}),"\n",(0,i.jsx)(n.h4,{id:"reference",children:"Reference"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://github.com/PX4/PX4-Autopilot/issues/25106",children:"https://github.com/PX4/PX4-Autopilot/issues/25106"})," ",(0,i.jsx)(n.a,{href:"https://discuss.px4.io/t/px4-sitl-multi-vehicle-gazebo-imu-timing-errors/33268/2",children:"https://discuss.px4.io/t/px4-sitl-multi-vehicle-gazebo-imu-timing-errors/33268/2"})," ",(0,i.jsx)(n.a,{href:"https://blog.csdn.net/2401_83038233/article/details/149101727",children:"https://blog.csdn.net/2401_83038233/article/details/149101727"})]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>o});var t=s(6540);const i={},r=t.createContext(i);function l(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);